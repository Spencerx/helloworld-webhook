sudo: required

language: php

services:
  - docker

before_install:
- docker login -u="$DOCKER_USERNAME" -p="$DOCKER_PASSWORD"

script:
- docker build -t containerum/helloworld-webhook:"$TRAVIS_COMMIT" .
- docker push containerum/helloworld-webhook:"$TRAVIS_COMMIT"

after_success:
- |
  curl -X POST \
  https://web.api.containerum.io:5000/api/set/image/"$CONTAINERUM_WEBHOOK" \
  -H 'content-type: application/json' \
  -d '{
  "image": "containerum/helloworld-webhook:'"$TRAVIS_COMMIT"'",
  "deployment_name": "hello-webhook",
  "namespace": "ten",
  "container_name": "hello-webhook"
  }'
